<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/pyodide/v0.19.0/full/pyodide.js"></script>
    <title>Bewerbungsformular</title>
</head>
<body>
  <div class="header">
    <h1 id="header" class="form-header" data-component="header">Bewerbung</h1>
    <div id="subHeader" class="form-subHeader">Bitte füllen Sie das untenstehende Formular aus, um sich für eine Stelle zu bewerben.</div>
  </div>
  <br/>
  <br/>

  <!-- Eingabefelder -->
  <label for="name">Vollständiger Name</label> <br>
  <div class="vorname">
    <input type="text" placeholder="Vorname" id="vornameInput" name="vorname" required="">
    <input type="text" placeholder="Nachname" id="nachnameInput" name="nachname" required="">
  </div>
  <br/>
  <div class="email">
    <label for="email">E-Mail</label> <br>
    <input type="email" placeholder="Geben sie eine gültige E-Mail-Adresse an" id="emailInput" name="email" required="">
  </div>
  <br/>
  <label for="anschrift">Derzeitige Anschrift</label> <br>
  <div class="straße">
    <input type="text" placeholder="Straße, Hausnummer" id="straßeInput" name="straße" required="">
  </div>
  <div class="ort">
    <input type="text" placeholder="PLZ, Wohnort" id="ortInput" name="ort" required="">
  </div>
  <br/>
  <label for="telefon">Telefon</label> <br>
  <div class="telefon">
    <input type="text" placeholder="Vorwahl" id="vorwahlInput" name="vorwahl" required="">
    <input type="text" placeholder="Nummer" id="nummerInput" name="nummer" required="">
  </div>
  <br/>
  <label for="art">Bewerbung auf</label> <br>
  <div class="art">
     <!-- Auswahlfeld adden (Pos1, Pos2, Pos3) mit Auswahl als Placeholder -->
     <!-- + unten in evaluatePython-Methode richtigen Feldnamen -->
  </div>
  <!-- Datei-Input-Feld -->
  <br/>
  <br/>
  <div class="button">
    <button onclick="evaluatePython()">Abschicken</button>
  </div>

    <br/>
    <br/>
    <div>Output:</div>
    <textarea id="output" style="width: 100%;" rows="30" disabled></textarea>  


    
    <script type="text/javascript">
      const output = document.getElementById("output");
      const link = document.getElementById("vorname");
        
      
      function addToOutput(s) {
        // Wert in, welcher eingegeben wird, wird in der Python Consolenansicht wiedergegeben  
        output.value += s + "\n";
      }

      output.value = "Initializing Python...\n";
      // init Pyodide
      async function main(){
        let pyodide = await loadPyodide({
          indexURL : "https://cdn.jsdelivr.net/pyodide/v0.19.0/full/"
        });

        output.value += "Ready!\n";
        return pyodide;
      }
      let pyodideReadyPromise = main();

      // execute with onClick
      async function evaluatePython() {

        let pyodide = await pyodideReadyPromise;

        try {
          // let output = pyodide.runPython(link.value);
          let output = pyodide.runPython(`
          import js
          import json
 
          # Data to be written
          data ={
            "person": [
              {
              "Vorname" : js.vornameInput.value,
              "Nachname" : js.nachnameInput.value,
              "E-Mail" : js.emailInput.value
              "Strasse/Hausnummer" : js.straßeInput.value,
              "PLZ/Wohnort" : js.ortInput.value,
              "Telefon" : js.vorwahlInput.value & js.nummerInput.value
              "Bewerbung auf" : js.artInput.value 
              }
            ]  
          }
            
          # Serializing json; indent -> spaces for the json formatting
          json_object = json.dumps(data, indent = 2)
            
          # Writing to data.json; open mode ('a' -> append new content to the end of the file, "r" & "rt" -> read, "w" & "wt" -> write)
          with open('/data.txt', 'a') as outfile:
              outfile.write(json_object)


          print(data)
          `);
          addToOutput(output);
          let x = pyodide.runPython("open('/data.txt', 'r').read()");
          addToOutput(x);

          

        } catch (err) {
          addToOutput(err);
        }
      }
    </script>
</body>
</html>